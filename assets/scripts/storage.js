import{toggleClassToArr as n,clamp as r,slowHideElement as e}from"./util.js";import{playRandomVoiceLine as o}from"./noise.js";let i={},c=[];const l={currentlySelected:0};function t(){return!i.historyWrapper.classList.contains("hidden")}function s(){n([i.historyWrapper,i.historyIcon,i.settings],"hidden"),e(i.cover),i.historyIcon.classList.remove("count-tickets-flipped"),i.historyIcon.addEventListener("transitionend",()=>{i.ticketCounter.classList.remove("no-opacity")},{once:!0}),i.cover.removeEventListener("click",s)}function u(){return JSON.parse(window.localStorage.getItem("tickets"))||[]}function d(e){i.inputCounter.innerText=c.length;let t;t=void 0===e?c.length:e,i.ticketCounter.innerText=t,i.inputField.value=l.currentlySelected+1}function a(e,t){var n=u();return!(99<=n.length||(n.push(e),window.localStorage.setItem("tickets",JSON.stringify(n)),"2d"!==t&&d(n.length),0))}function y(e){window.localStorage.setItem("tickets",JSON.stringify(e))}function h(){c.forEach((e,t)=>{var t=t-l.currentlySelected,n=300*(t<0?-1:1)*(1-.9**Math.abs(t)),t=.9**Math.abs(t);e.style.transform=`translate(calc(${n}vw - 50%), 0) scale(${t})`}),i.leftButton.classList.remove("dead-button"),i.rightButton.classList.remove("dead-button"),0===l.currentlySelected?i.leftButton.classList.add("dead-button"):l.currentlySelected===c.length-1&&i.rightButton.classList.add("dead-button")}function v(e){var t=c.indexOf(e);-1!==t&&(i.ticketHistory.removeChild(e),c.splice(t,1),(e=u()).splice(t,1),y(e),0===c.length?l.currentlySelected=0:l.currentlySelected=r(l.currentlySelected,0,c.length-1),d(),h(),0===c.length)&&s()}function p(e,t){e.forEach(e=>{e[t+"EventListener"]("mouseover",e.handleButtonOverlay),e[t+"EventListener"]("mouseout",e.handleButtonOverlay)})}function g(){var e,t=u();0!==t.length&&(i.ticketCounter.classList.add("no-opacity"),e=[i.cover,i.historyWrapper,i.historyIcon,i.settings],n(e,"hidden"),c.length!==t.length&&(p(c,"remove"),c=[],t.forEach(e=>{var t=document.createElement("historical-ticket");t.content=e,c.push(t)}),i.ticketHistory.replaceChildren(...c)),c[l.currentlySelected].selected=!0,i.inputCounter.innerText=c.length,i.cover.addEventListener("click",s),p(c,"add"),h(),o())}function m(e){var t;l.currentlySelected=(t=l.currentlySelected,r(t+e,0,c.length-1)),i.inputField.value=l.currentlySelected+1,h()}function f(){e=i.inputField.value,t=l.currentlySelected+1,e=+e;var e,t=Number.isNaN(e)?t:r(e,1,c.length);i.inputField.value=t,l.currentlySelected=t-1,h()}function S(e){t()&&("ArrowLeft"===e.key?m(-1):"ArrowRight"===e.key?m(1):"Escape"===e.key&&s())}window.addEventListener("DOMContentLoaded",function(){(i={ticketCounter:document.getElementById("ticket-count"),historyIcon:document.querySelector(".count-tickets-icon"),cover:document.querySelector(".cover"),ticketHistory:document.querySelector(".ticket-history"),leftButton:document.querySelector("#left-button"),rightButton:document.querySelector("#right-button"),inputField:document.querySelector("#ticket-history-input"),inputCounter:document.querySelector("#ticket-history-total"),exitHistoryButton:document.querySelector("#close-history"),historyWrapper:document.querySelector(".history-wrapper"),settings:document.querySelector(".settings-menu-container")}).historyIcon.addEventListener("click",()=>{0!==u().length&&(i.historyIcon.classList.add("count-tickets-flipped"),i.historyIcon.addEventListener("transitionend",g,{once:!0}))}),i.inputField.addEventListener("change",f),i.exitHistoryButton.addEventListener("click",s),i.leftButton.addEventListener("click",()=>{m(-1)}),i.rightButton.addEventListener("click",()=>{m(1)}),window.addEventListener("keydown",S),d(u().length)});export{t as historyIsOpen,u as getAllTickets,a as saveState,y as saveAllStates,v as deleteCard};